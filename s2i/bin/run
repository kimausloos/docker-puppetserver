#!/bin/bash -e
#
# S2I run script for the 'puppetserver' image.

exec echo '-----BEGIN RSA PRIVATE KEY-----' > /etc/puppetlabs/puppet/ssl/ca/ca_key.pem && echo $CAKEY | tr ' ' '\n' >> /etc/puppetlabs/puppet/ssl/ca/ca_key.pem && echo '-----END RSA PRIVATE KEY-----' >> /etc/puppetlabs/puppet/ssl/ca/ca_key.pem && openssl ca -config /certs/openssl_ca.cnf -gencrl -out /etc/puppetlabs/puppet/ssl/ca/ca_crl.pem && /usr/local/bin/start-puppet-server
